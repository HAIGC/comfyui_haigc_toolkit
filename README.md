# HAIGC Toolkit（ComfyUI 自定义节点）

HAIGC Toolkit 是一套面向 ComfyUI 的视频/图片处理节点合集，包含字幕（增强版/时间戳专业版）、图片批处理，以及一组常用视频剪辑节点。

## 作者信息

- 作者网名：HAIGC（全网同名）
- 微信号：HAIGC1994

## 安装方法（Windows 示例）

1. 将本目录 `haigc_toolkit` 放到你的 ComfyUI 目录下：
   - `ComfyUI/custom_nodes/haigc_toolkit`
2. 重启 ComfyUI（或重启 ComfyUI Server）。
3. 在节点列表中搜索 `HAIGC`，即可看到本工具集节点。

## 依赖说明（重点：ffmpeg）

本工具集分为两类节点：只处理 `IMAGE` 帧序列的节点、以及需要读写/转码视频的节点。两类依赖不同：

### 基础依赖（一般 ComfyUI 环境自带）

- `torch`
- `numpy`
- `Pillow`（PIL）
- ComfyUI 自身（含 `folder_paths`）

### 可选依赖（按功能启用）

- `ffmpeg`（系统可执行程序，建议安装并加入 PATH）
  - 用途：视频转码、合并音频、部分视频处理流程、专业版“烧录字幕到视频”等。
  - 现象：未安装时，相关功能会提示“未找到 ffmpeg”。
- `opencv-python`（Python 包，提供 `cv2`）
  - 用途：部分视频读取/写出/解析流程。
  - 现象：未安装时，涉及 `cv2` 的功能不可用或报错。

### ffmpeg 安装与 PATH（简要）

- 安装后确保命令行可以执行：
  - `ffmpeg -version`
- Windows 常见做法：把 `ffmpeg.exe` 所在目录加入系统环境变量 `PATH`。

## 节点列表（显示名）

### 字幕类

- 视频字幕增强版(v2.6) 🎬
- 视频字幕时间戳(专业版) ⚡
- 时间戳文本替换(专业版) 📝

### 图片类

- 图片批次累积 📦
- 图像批次复制 🔄

### 视频类

- 获取视频尾帧 🎞️
- 视频拼接过渡 🔗

### 视频剪辑节点集合

视频剪辑子模块提供以下节点（节选为显示名）：

- 视频加载器 📂
- 视频保存 💾 / 批量视频保存 💾
- 视频信息解析器 🔍 / 视频信息预览 📝 / 视频剪辑预览 🎬
- 视频时间裁剪 ⏱️ / 视频变速 🎬 / 视频倒放 🔄 / 画面裁切 ✂️ / 视频旋转 🔄 / 视频翻转 🔀 / 视频缩放 📐 / 淡入淡出 🌅 / 视频循环 🔁
- 视频拼接 🎞️ / 视频混剪 🎞️ / 分镜识别 🎯 / 分镜转接 🎬 / 分镜音视频裁剪 🎧 / 无限循环 ♾️
- 卡点效果 💥 / 画中画 📺
- 关键帧动画 🎬 / 蒙版功能 🎭

## 使用方法（常见工作流）

### 1）纯 IMAGE 工作流（不依赖 ffmpeg）

适合你已经有帧序列（`IMAGE`）的场景，例如 ComfyUI 内部生成或外部导入：

1. 准备 `IMAGE`（例如来自视频加载器、或其他图像节点输出）。
2. 连接到字幕节点：
   - “视频字幕增强版(v2.6) 🎬” 或 “视频字幕时间戳(专业版) ⚡”
3. 按需设置：
   - 字体/字号/描边/投影/渐变/动效
   - “最大行数”：用于多行字幕（1–10）
   - “限定在画布内”：自动缩放或按字裁剪
4. 输出仍为 `IMAGE`，继续后续处理或交给视频保存节点。

### 2）视频读写/转码工作流（建议安装 ffmpeg + opencv-python）

典型流程：

1. 使用“视频加载器 📂”载入视频（得到帧序列/信息/音频等）。
2. 串联字幕/剪辑/转场等节点处理帧序列。
3. 用“视频保存 💾 / 批量视频保存 💾”导出视频。
   - 部分格式或合并音频会调用 ffmpeg。

## 字幕节点功能要点

### 视频字幕增强版(v2.6) 🎬

- 支持横排/竖排、旋转、渐变、描边、投影、动效
- 支持多行字幕（“最大行数” 1–10）
- 支持打字机动效的逐字显示（多行也兼容）

### 视频字幕时间戳(专业版) ⚡

- 支持字幕时间轴格式（SRT/简单/括号/无时间戳）
- 支持丰富动效、渐变、描边、投影、滚动字幕
- 支持多行字幕（“最大行数” 1–10）
- 部分“烧录字幕到视频/转码”流程需要 ffmpeg

## 常见问题

### 1）提示“未找到 ffmpeg”

- 安装 ffmpeg 并加入 PATH，然后重启 ComfyUI。
- 确认命令行执行 `ffmpeg -version` 正常。

### 2）报错缺少 cv2 / opencv

- 安装 `opencv-python` 后重启 ComfyUI。

### 3）字体找不到/显示异常

- 字体来自本节点目录的 `font/` 文件夹（如需自定义字体，把 `.ttf/.otf/.ttc` 放入该目录）。

