# 视频剪辑节点集 使用指南

## 📦 节点列表

本模块包含 **9个独立的视频剪辑节点**，每个节点专注于一个功能。

### 节点总览

| 节点 | 功能 | 输入 | 输出 |
|------|------|------|------|
| 🎬 **视频时间裁剪** | 按时间/帧数裁剪 | 视频+时间/帧数 | 裁剪后的视频 |
| ⚡ **视频变速** | 加速/减速/定格 | 视频+速度参数 | 变速后的视频 |
| 🔄 **视频倒放** | 反向播放 | 视频 | 倒放后的视频 |
| ✂️ **画面裁切** | 裁切画面区域 | 视频+坐标尺寸 | 裁切后的视频 |
| 🔄 **视频旋转** | 90/180/270度 | 视频+旋转角度 | 旋转后的视频 |
| 🔀 **视频翻转** | 水平/垂直翻转 | 视频+翻转方式 | 翻转后的视频 |
| 📐 **视频缩放** | 改变分辨率 | 视频+目标尺寸 | 缩放后的视频 |
| 🌅 **淡入淡出** | 渐变效果 | 视频+淡入/出时长 | 添加淡化的视频 |
| 🔁 **视频循环** | 重复播放 | 视频+循环次数 | 循环后的视频 |

---

## 🎯 典型工作流

### 工作流1: 快速裁剪+加速
```
视频加载 → 视频时间裁剪(0-10秒) → 视频变速(2倍) → 输出
```
**效果**: 提取前10秒，并以2倍速播放

---

### 工作流2: 竖屏视频制作
```
视频加载 → 画面裁切(720x1280) → 视频缩放(1080x1920) → 输出
```
**效果**: 从横屏视频中提取竖屏区域

---

### 工作流3: 创意倒放+慢动作
```
视频加载 → 视频倒放 → 视频变速(0.5倍) → 淡入淡出(1秒/1秒) → 输出
```
**效果**: 倒放+慢动作+淡化效果

---

### 工作流4: 循环背景素材
```
视频加载 → 视频时间裁剪(提取5秒) → 淡入淡出(0.5秒/0.5秒) → 视频循环(5次) → 输出
```
**效果**: 制作25秒的无缝循环背景

---

### 工作流5: 复杂组合
```
视频加载 → 视频时间裁剪 → 画面裁切 → 视频旋转 → 视频缩放 → 淡入淡出 → 输出
```
**效果**: 多功能组合使用

---

## 📖 节点详解

### 1️⃣ 视频时间裁剪 (VideoTrim)

**参数说明**:
- **裁剪模式**: `按时间` 或 `按帧数`
- **开始时间**: 起始时间（秒），精确到0.01秒
- **结束时间**: 结束时间（秒），0表示视频结尾
- **开始帧**: 起始帧号
- **结束帧**: 结束帧号，0表示最后一帧

**使用示例**:
```
裁剪模式: 按时间
开始时间: 5.00
结束时间: 15.00
→ 提取5-15秒的视频片段
```

---

### 2️⃣ 视频变速 (VideoSpeed)

**参数说明**:
- **变速模式**: `正常速度` / `加速` / `减速` / `定格`
- **速度倍数**: 0.1 ~ 10.0倍
- **定格帧位置**: 定格的帧号
- **定格时长**: 定格持续时间（秒）

**使用示例**:
```
# 2倍速加速
变速模式: 加速
速度倍数: 2.0

# 0.5倍慢动作
变速模式: 减速
速度倍数: 0.5

# 第100帧定格2秒
变速模式: 定格
定格帧位置: 100
定格时长: 2.0
```

**技术细节**:
- 使用帧索引+线性插值算法
- 支持所有数据类型
- 平滑的变速效果

---

### 3️⃣ 视频倒放 (VideoReverse)

**功能**: 反向播放视频，无需参数

**使用场景**:
- 创意倒放效果
- 回放镜头
- 魔术般的视觉效果

---

### 4️⃣ 画面裁切 (VideoCrop)

**参数说明**:
- **裁切X坐标**: 左上角X坐标
- **裁切Y坐标**: 左上角Y坐标
- **裁切宽度**: 裁切区域宽度
- **裁切高度**: 裁切区域高度

**使用示例**:
```
# 提取中心区域
裁切X坐标: 200
裁切Y坐标: 100
裁切宽度: 1280
裁切高度: 720
```

**常见应用**:
- 移除画面边缘
- 提取中心主体
- 转换画面比例

---

### 5️⃣ 视频旋转 (VideoRotate)

**参数说明**:
- **旋转角度**: `0度` / `90度顺时针` / `180度` / `90度逆时针`

**使用场景**:
- 竖屏横屏转换
- 纠正拍摄角度
- 创意旋转效果

---

### 6️⃣ 视频翻转 (VideoFlip)

**参数说明**:
- **翻转方式**: `不翻转` / `水平翻转` / `垂直翻转` / `水平+垂直`

**使用场景**:
- 镜像效果
- 纠正拍摄方向
- 对称视觉效果

---

### 7️⃣ 视频缩放 (VideoResize)

**参数说明**:
- **目标宽度**: 输出视频宽度
- **目标高度**: 输出视频高度
- **缩放算法**: `双线性` / `双三次` / `最近邻`

**算法选择**:
- **双三次**: 高质量，适合放大（推荐）
- **双线性**: 平衡质量和速度
- **最近邻**: 快速，适合缩小

**使用示例**:
```
# 缩放到1080P
目标宽度: 1920
目标高度: 1080
缩放算法: 双三次

# 缩放到720P
目标宽度: 1280
目标高度: 720
缩放算法: 双线性
```

---

### 8️⃣ 淡入淡出 (VideoFade)

**参数说明**:
- **淡入时长**: 开头淡入时间（秒）
- **淡出时长**: 结尾淡出时间（秒）

**使用示例**:
```
# 1秒淡入，2秒淡出
淡入时长: 1.0
淡出时长: 2.0
```

**效果**:
- 淡入：从黑色渐变到正常
- 淡出：从正常渐变到黑色

---

### 9️⃣ 视频循环 (VideoLoop)

**参数说明**:
- **循环次数**: 2 ~ 100次

**使用示例**:
```
# 循环5次
循环次数: 5
```

**应用场景**:
- 循环背景素材
- 延长短视频时长
- GIF式循环效果

---

## ⚡ 性能优化建议

### 1. 节点顺序优化
```
推荐顺序:
裁剪 → 变速 → 倒放 → 裁切 → 旋转 → 翻转 → 缩放 → 淡入淡出 → 循环
```

**原因**: 先减少数据量（裁剪），再进行计算密集型操作（变速），最后添加效果

---

### 2. 避免重复处理
❌ **不推荐**:
```
缩放(1080P) → 缩放(720P)  # 两次缩放降低质量
```

✅ **推荐**:
```
直接缩放到目标分辨率
```

---

### 3. 合理使用循环
- 循环次数过多会占用大量内存
- 建议先处理完所有效果，最后再循环

---

## 🔧 常见问题

### Q1: 节点输出连接不上？
**A**: 确保所有节点的输出类型一致（IMAGE, INT, FLOAT）

### Q2: 裁剪后视频变黑？
**A**: 检查时间/帧数范围是否超出视频长度

### Q3: 变速后画面卡顿？
**A**: v1.0.0已修复，使用新的线性插值算法，更加平滑

### Q4: 缩放后画质模糊？
**A**: 使用"双三次"算法，质量最高

### Q5: 循环后文件太大？
**A**: 先压缩视频长度（裁剪），再循环

---

## 📊 输出说明

所有节点输出3个值：
1. **视频** (IMAGE): 处理后的视频帧
2. **输出帧数** (INT): 总帧数
3. **输出时长** (FLOAT): 总时长（秒）

这些输出可以连接到：
- 其他视频剪辑节点（继续处理）
- 字幕节点（添加字幕）
- 保存节点（导出视频）

---

## 🎨 创意应用案例

### 案例1: 电影感片头
```
视频 → 视频时间裁剪(前5秒) → 视频变速(0.8倍慢动作) → 淡入淡出(2秒/0秒) → 输出
```

### 案例2: 社交媒体竖屏视频
```
视频 → 画面裁切(中心1080x1920) → 视频缩放(1080x1920) → 输出
```

### 案例3: 鬼畜循环视频
```
视频 → 视频时间裁剪(提取1秒) → 视频变速(1.5倍) → 视频循环(10次) → 输出
```

### 案例4: 镜面对称效果
```
视频A → 视频翻转(水平) → 与原视频拼接 → 输出
```

---

## 📚 技术细节

### 数据流
```
视频帧 (torch.Tensor) → 处理 → 输出帧 (torch.Tensor)
形状: [B, H, W, C]
- B: 批次大小（帧数）
- H: 高度
- W: 宽度
- C: 通道数（RGB = 3）
```

### GPU加速
- 所有节点使用PyTorch实现
- 自动使用GPU（如果可用）
- CPU回退支持

### 内存管理
- 自动释放临时变量
- 大文件处理优化
- 流式处理支持

---

## 🆕 更新日志

### v1.0.0 (2024-11-04)
- ✅ 初始发布
- ✅ 9个独立节点
- ✅ 从专业视频剪辑节点拆分
- ✅ 模块化设计
- ✅ 统一接口

---

## 💡 提示与技巧

1. **组合使用**: 多个节点串联可实现复杂效果
2. **参数微调**: 使用0.01秒精度精确控制
3. **预览输出**: 先用小范围测试参数
4. **保存配置**: 常用组合可保存为工作流模板
5. **性能优先**: 大文件先裁剪再处理

---

## 📧 反馈与支持

如有问题或建议，欢迎反馈！

**HAIGC Toolkit Team**

